<!DOCTYPE html>
<html lang="lt">
<head>
  <meta charset="UTF-8">
  <title>Upi≈≥ vietos viktorina</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    #map { height: 80vh; }
    #quiz {
      padding: 10px;
      background: #f0f0f0;
    }
    #question { font-size: 18px; }
    #result { margin-top: 10px; font-weight: bold; }
  </style>
</head>
<body>

<div id="quiz">
  <div id="question">Klausimas kraunasi...</div>
  <div id="result"></div>
</div>
<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  const map = L.map('map').setView([55.2, 24.0], 7);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap',
  }).addTo(map);

  const rivers = [
    { name: "Nemunas", coords: [54.6872, 25.2797] },
    { name: "Neris", coords: [54.9000, 23.9000] },
    { name: "≈†ventoji", coords: [55.5000, 25.0000] },
    { name: "Venta", coords: [56.3333, 22.0000] },
    { name: "Merkys", coords: [54.1833, 24.6667] },
    { name: "Minija", coords: [55.7000, 21.6000] },
    { name: "J≈´ra", coords: [55.3000, 22.3000] },
    { name: "Dubysa", coords: [55.4000, 23.0000] },
    { name: "Nevƒó≈æis", coords: [55.3000, 23.9000] },
    { name: "≈Ωeimena", coords: [55.2000, 26.0000] }
  ];

  let currentRiver = null;
  let guessMarker = null;
  let answerMarker = null;

  function toRad(deg) {
    return deg * Math.PI / 180;
  }

  function getDistanceKm(lat1, lon1, lat2, lon2) {
    const R = 6371;
    const dLat = toRad(lat2 - lat1);
    const dLon = toRad(lon2 - lon1);
    const a = Math.sin(dLat/2) ** 2 +
              Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
              Math.sin(dLon/2) ** 2;
    return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  }

  function startRound() {
    if (guessMarker) map.removeLayer(guessMarker);
    if (answerMarker) map.removeLayer(answerMarker);
    document.getElementById("result").textContent = "";

    currentRiver = rivers[Math.floor(Math.random() * rivers.length)];
    document.getElementById("question").innerHTML =
      `Kur yra upƒó: <strong>${currentRiver.name}</strong>? Spausk du kartus.`;
  }

  map.on('click', function(e) {
    if (guessMarker) map.removeLayer(guessMarker);

    guessMarker = L.marker(e.latlng).addTo(map);
    guessMarker.bindPopup("Spustelƒók dar kartƒÖ, kad patvirtintum").openPopup();

    guessMarker.on('click', function() {
      const guessedLat = e.latlng.lat;
      const guessedLng = e.latlng.lng;
      const correctLat = currentRiver.coords[0];
      const correctLng = currentRiver.coords[1];

      const distance = getDistanceKm(guessedLat, guessedLng, correctLat, correctLng);

      // Rodyti teisingƒÖ vietƒÖ
      answerMarker = L.marker(currentRiver.coords, {
        icon: L.icon({
          iconUrl: 'https://maps.google.com/mapfiles/ms/icons/blue-dot.png',
          iconSize: [32, 32],
          iconAnchor: [16, 32]
        })
      }).addTo(map).bindPopup(`Teisinga vieta: ${currentRiver.name}`).openPopup();

      // Ta≈°kai
      let score = 0;
      if (distance < 5) score = 10;
      else if (distance < 15) score = 8;
      else if (distance < 30) score = 6;
      else if (distance < 50) score = 4;
      else if (distance < 100) score = 2;
      else score = 0;

      document.getElementById("result").innerHTML =
        `üìè Atstumas: ${distance.toFixed(1)} km<br>‚≠ê Ta≈°kai: ${score} / 10`;

      setTimeout(startRound, 5000);
    });
  });

  startRound();
</script>

</body>
</html>
